version: '3'
services:
  api:
    build: .
    container_name: "api-dev"
    command: npm run dev
    ports:
      - "8080:8080"
    environment: # Set ENV vars
      - NODE_ENV=dev
      - PORT=8080
      - ES_HOST=elasticsearch
      - MONGODB_URI=mongodb://db:27017/dev-todos
    volumes:
      - .:/usr/app/
      - ./people:/usr/app/people
      - /usr/app/node_modules
    depends_on:
      - db
  db:
    container_name: "mongodb-dev"
    image: mongo:latest
    ports:
      - "27017:27017"
    environment:
      - MONGODB_USER="dev-user" 
      - MONGODB_PASS="dev-pass"
  elasticsearch: # Elasticsearch Instance
    container_name: es-api
    image: docker.elastic.co/elasticsearch/elasticsearch:6.1.1
    volumes: # Persist ES data in seperate "esdata" volume
      - esdata:/usr/share/elasticsearch/data
    ports: # Expose Elasticsearch ports
      - "9300:9300"
      - "9200:9200"
volumes: # Define seperate volume for Elasticsearch data
  esdata: